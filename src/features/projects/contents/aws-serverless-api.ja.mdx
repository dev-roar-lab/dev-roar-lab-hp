---
title: 'AWS サーバーレスAPI基盤の構築'
publishedAt: '2024-03-15'
summary: 'Lambda、API Gateway、DynamoDBを活用したスケーラブルなサーバーレスAPI基盤を設計・構築しました。'
tags: ['AWS', 'Lambda', 'API Gateway', 'DynamoDB', 'Python']
---

## プロジェクト概要

大規模トラフィックに対応するため、完全サーバーレスなAPI基盤をAWS上に構築しました。従来のEC2ベースのシステムから移行することで、運用コストを大幅に削減し、スケーラビリティを向上させました。

## 使用技術

- **AWS Lambda**: ビジネスロジックの実装
- **API Gateway**: RESTful APIのエンドポイント管理
- **DynamoDB**: NoSQLデータベース
- **CloudFormation**: インフラのコード化（IaC）
- **Python 3.11**: Lambda関数の実装言語
- **CI/CD**: GitHub Actions

## 主な機能

### 1. スケーラブルなAPI設計

Lambda関数の自動スケーリングにより、トラフィックの急増にも柔軟に対応。同時実行数の制御やプロビジョニング済み同時実行数の設定により、安定したパフォーマンスを実現しました。

### 2. セキュリティ対策

- API Gatewayでの認証・認可（Lambda Authorizer）
- IAMロールによる最小権限の原則の適用
- VPCエンドポイントを使用した安全な通信
- CloudWatch Logsによる監視とアラート

### 3. コスト最適化

従来のEC2ベースのシステムと比較して、月間運用コストを **60%削減** しました。

```python
# Lambda関数の例
import json
import boto3
from typing import Dict, Any

dynamodb = boto3.resource('dynamodb')
table = dynamodb.Table('users')

def lambda_handler(event: Dict[str, Any], context: Any) -> Dict[str, Any]:
    try:
        user_id = event['pathParameters']['id']
        response = table.get_item(Key={'userId': user_id})

        if 'Item' not in response:
            return {
                'statusCode': 404,
                'body': json.dumps({'error': 'User not found'})
            }

        return {
            'statusCode': 200,
            'body': json.dumps(response['Item'])
        }
    except Exception as e:
        return {
            'statusCode': 500,
            'body': json.dumps({'error': str(e)})
        }
```

## 成果

- **パフォーマンス**: レスポンスタイム平均50ms以下を維持
- **コスト削減**: 月間運用コスト60%削減
- **可用性**: 99.99%のアップタイムを達成
- **スケーラビリティ**: 秒間1000リクエストまで対応可能

## 学んだこと

サーバーレスアーキテクチャの設計において、コールドスタート対策やDynamoDBのキャパシティ設計など、実運用を見据えた最適化の重要性を学びました。また、CloudFormationによるIaCの実践により、再現性の高いインフラ構築が可能になりました。
